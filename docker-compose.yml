services:
  redis:
    image: redis:7-alpine
    container_name: yablog-redis
    restart: unless-stopped
    command: ["redis-server", "--appendonly", "yes"]
    volumes:
      - redis-data:/data

  yablog:
    build: .
    container_name: yablog
    restart: unless-stopped
    ports:
      - "8787:8787"
    env_file:
      - .env
    environment:
      PORT: "8787"
      NODE_ENV: "production"
      DATABASE_PATH: "/data/yablog.db"
      WEB_DIST_PATH: "/app/apps/web/dist"
      COOKIE_SECURE: "0"
      REDIS_URL: "redis://redis:6379/0"
      TZ: "Asia/Shanghai"
    volumes:
      - ./data:/data
    depends_on:
      - redis

volumes:
  redis-data:
